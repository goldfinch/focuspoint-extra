(function(f){f.entwine("ss",t=>{t(".cms-edit-form").entwine({getCoordField(i){const o=`input[name='${i.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName")}']`;return this.closest(".image-coord-fieldgroup").find(o)},updateGrid(){const i=t(".ss-gridfield-item .image-coord-field");i.length&&i.closest("td").addClass("imagecoord image-coord-fieldgroup");const e=t(this),o=e.getCoordField("x").val(),s=e.getCoordField("y").val(),n=Math.floor(-11/2),d=e.width(),c=e.height(),l=this.data("cssGrid")?n+o*d:n+(o/2+.5)*d,r=this.data("cssGrid")?n+s*c:n+(-s/2+.5)*c;e.css("background-position",`${l}px ${r}px`),e.find(".fpaim").css({left:Math.round((Number(o)+1)*.5*d),top:Math.round((Number(s)+1)*.5*c),width:d*2,height:c*2})},onadd(){t(".image-coord-field .grid").each(function(i,e){t(e).closest(".ui-accordion").length&&t(e).closest(".ui-accordion").find(".ui-accordion-header").click(()=>{t(this).updateGrid()})}),this._super()},onchange(){t(".uploadfield-item__remove-btn").off("click").click(i=>{const e=t(i.currentTarget).closest(".entwine-uploadfield.uploadfield").find("input");if(e.length){const o=e.attr("name").split("[")[0],s=t(`input[name="${o}-_1_-FocusPointX"]`);s.length&&s.closest(".CompositeField.togglecomposite").remove()}})}});function h(){t(".image-coord-field .grid").each(function(){t(this).updateGrid()})}t(window).on("resize",h),t(".image-coord-field .grid").entwine({onmatch(){const i=this;setTimeout(()=>{t(".image-coord-fieldgroup").length&&t(".ui-tabs-anchor").click(e=>{setTimeout(()=>{i.updateGrid()},200)}),i.updateGrid()},200)},getFieldSelector(i){return`input[name='${i.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName")}']`},getCoordField(i){const e=this.getFieldSelector(i);return this.closest(".image-coord-fieldgroup").find(e)},roundXYValues(i){return i.toFixed(4)},updateGrid(){const i=t(".ss-gridfield-item .image-coord-field");i.length&&i.closest("td").addClass("imagecoord image-coord-fieldgroup");const e=t(this),o=new Image;o.src=e.closest(".image-coord-field").find("img").attr("src"),o.onload=()=>{setTimeout(()=>{const s=e.getCoordField("x").val(),a=e.getCoordField("y").val(),d=Math.floor(-11/2),c=e.width(),l=e.height(),r=this.data("cssGrid")?d+s*c:d+(s/2+.5)*c,g=this.data("cssGrid")?d+a*l:d+(-a/2+.5)*l;e.css("background-position",`${r}px ${g}px`),e.find(".fpaim").css({left:Math.round((Number(s)+1)*.5*c),top:Math.round((Number(a)+1)*.5*l),width:c*2,height:l*2})},200)}},onclick(i){const e=t(this),o=e.width(),s=e.height(),a=i.pageX-e.offset().left,n=i.pageY-e.offset().top,d=this.data("cssGrid")?a/o:(a/o-.5)*2,c=this.data("cssGrid")?n/s:(n/s-.5)*2;this.getCoordField("x").val(d),this.getCoordField("y").val(c),this.updateGrid(),t(this).closest("form").addClass("changed"),t(this.getFieldSelector("x")).length&&t(this.getFieldSelector("x")).each((l,r)=>{t(r).hasClass("editable-column-field")||t(r).change()}),t(this.getFieldSelector("y")).length&&t(this.getFieldSelector("y")).each((l,r)=>{t(r).hasClass("editable-column-field")||t(r).change()})},onmousemove(i){const e=t(this),o=e.width(),s=e.height(),a=i.pageX-e.offset().left,n=i.pageY-e.offset().top,d=this.data("cssGrid")?a/o:(a/o-.5)*2,c=this.data("cssGrid")?n/s:(n/s-.5)*-2;this.closest(".image-coord-fieldgroup").find(".sumField").html(`mouseX ${this.roundXYValues(d)} / mouseY ${this.roundXYValues(c)}`)}})})})(jQuery);
