(function(n){n.entwine("ss",function(i){i(".cms-edit-form").entwine({getCoordField:function(t){var e=t.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName"),d="input[name='"+e+"']";return this.closest(".image-coord-fieldgroup").find(d)},updateGrid:function(){let t=i(".ss-gridfield-item .image-coord-field");t.length&&t.closest("td").addClass("imagecoord image-coord-fieldgroup");var e=i(this),d=e.getCoordField("x").val(),o=e.getCoordField("y").val(),l=11,s=Math.floor(-l/2),a=e.width(),r=e.height(),f=this.data("cssGrid")?s+d*a:s+(d/2+.5)*a,c=this.data("cssGrid")?s+o*r:s+(-o/2+.5)*r;e.css("background-position",f+"px "+c+"px"),e.find(".fpaim").css({left:Math.round((Number(d)+1)*.5*a),top:Math.round((Number(o)+1)*.5*r),width:a*2,height:r*2})},onadd:function(){i(".image-coord-field .grid").each(function(t,e){i(e).closest(".ui-accordion").length&&i(e).closest(".ui-accordion").find(".ui-accordion-header").click(()=>{i(this).updateGrid()})}),this._super()},onchange:function(){i(".uploadfield-item__remove-btn").off("click").click(t=>{let e=i(t.currentTarget).closest(".entwine-uploadfield.uploadfield").find("input");if(e.length){let d=e.attr("name").split("[")[0],o=i('input[name="'+d+'-_1_-FocusPointX"]');o.length&&o.closest(".CompositeField.togglecomposite").remove()}})}});function u(){i(".image-coord-field .grid").each(function(){i(this).updateGrid()})}i(window).on("resize",u),i(".image-coord-field .grid").entwine({onmatch:function(){var t=this;setTimeout(function(){i(".image-coord-fieldgroup").length&&i(".ui-tabs-anchor").click(e=>{setTimeout(()=>{t.updateGrid()},200)}),t.updateGrid()},200)},getFieldSelector:function(t){var e=t.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName");return"input[name='"+e+"']"},getCoordField:function(t){var e=this.getFieldSelector(t);return this.closest(".image-coord-fieldgroup").find(e)},roundXYValues:function(t){return t.toFixed(4)},updateGrid:function(){let t=i(".ss-gridfield-item .image-coord-field");t.length&&t.closest("td").addClass("imagecoord image-coord-fieldgroup");var e=i(this),d=new Image;d.src=e.closest(".image-coord-field").find("img").attr("src"),d.onload=()=>{setTimeout(()=>{var o=e.getCoordField("x").val(),l=e.getCoordField("y").val(),s=11,a=Math.floor(-s/2),r=e.width(),f=e.height(),c=this.data("cssGrid")?a+o*r:a+(o/2+.5)*r,h=this.data("cssGrid")?a+l*f:a+(-l/2+.5)*f;e.css("background-position",c+"px "+h+"px"),e.find(".fpaim").css({left:Math.round((Number(o)+1)*.5*r),top:Math.round((Number(l)+1)*.5*f),width:r*2,height:f*2})},200)}},onclick:function(t){var e=i(this),d=e.width(),o=e.height(),l=t.pageX-e.offset().left,s=t.pageY-e.offset().top,a=this.data("cssGrid")?l/d:(l/d-.5)*2,r=this.data("cssGrid")?s/o:(s/o-.5)*2;this.getCoordField("x").val(a),this.getCoordField("y").val(r),this.updateGrid(),i(this).closest("form").addClass("changed"),i(this.getFieldSelector("x")).length&&i(this.getFieldSelector("x")).each((f,c)=>{i(c).hasClass("editable-column-field")||i(c).change()}),i(this.getFieldSelector("y")).length&&i(this.getFieldSelector("y")).each((f,c)=>{i(c).hasClass("editable-column-field")||i(c).change()})},onmousemove:function(t){var e=i(this),d=e.width(),o=e.height(),l=t.pageX-e.offset().left,s=t.pageY-e.offset().top,a=this.data("cssGrid")?l/d:(l/d-.5)*2,r=this.data("cssGrid")?s/o:(s/o-.5)*-2,f=this.closest(".image-coord-fieldgroup").find(".sumField");f.html("mouseX "+this.roundXYValues(a)+" / mouseY "+this.roundXYValues(r))}})})})(jQuery);
