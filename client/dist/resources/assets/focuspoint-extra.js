(function(n){n.entwine("ss",function(i){i(".cms-edit-form").entwine({getCoordField:function(t){var e=t.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName"),d="input[name='"+e+"']";return this.closest(".image-coord-fieldgroup").find(d)},updateGrid:function(){let t=i(".ss-gridfield-item .image-coord-field");t.length&&t.closest("td").addClass("imagecoord image-coord-fieldgroup");var e=i(this),d=e.getCoordField("x").val(),o=e.getCoordField("y").val(),l=11,a=Math.floor(-l/2),r=e.width(),s=e.height(),c=this.data("cssGrid")?a+d*r:a+(d/2+.5)*r,f=this.data("cssGrid")?a+o*s:a+(-o/2+.5)*s;e.css("background-position",c+"px "+f+"px"),e.find(".fpaim").css({left:Math.round((Number(d)+1)*.5*r),top:Math.round((Number(o)+1)*.5*s),width:r*2,height:s*2})},onadd:function(){i(".image-coord-field .grid").each(function(t,e){i(e).closest(".ui-accordion").length&&i(e).closest(".ui-accordion").find(".ui-accordion-header").click(()=>{i(this).updateGrid()})}),this._super()},onchange:function(){i(".uploadfield-item__remove-btn").off("click").click(t=>{let e=i(t.currentTarget).closest(".entwine-uploadfield.uploadfield").find("input");if(e.length){let d=e.attr("name").split("[")[0],o=i('input[name="'+d+'-_1_-FocusPointX"]');o.length&&o.closest(".CompositeField.togglecomposite").remove()}})}});function u(){i(".image-coord-field .grid").each(function(){i(this).updateGrid()})}i(window).on("resize",u),i(".image-coord-field .grid").entwine({onmatch:function(){var t=this;setTimeout(function(){i(".image-coord-fieldgroup").length&&i(".ui-tabs-anchor").click(e=>{setTimeout(()=>{t.updateGrid()},200)}),t.updateGrid()},200)},getFieldSelector:function(t){var e=t.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName");return"input[name='"+e+"']"},getCoordField:function(t){var e=this.getFieldSelector(t);return this.closest(".image-coord-fieldgroup").find(e)},roundXYValues:function(t){return t.toFixed(4)},updateGrid:function(){let t=i(".ss-gridfield-item .image-coord-field");t.length&&t.closest("td").addClass("imagecoord image-coord-fieldgroup");var e=i(this),d=e.getCoordField("x").val(),o=e.getCoordField("y").val(),l=11,a=Math.floor(-l/2),r=e.width(),s=e.height(),c=this.data("cssGrid")?a+d*r:a+(d/2+.5)*r,f=this.data("cssGrid")?a+o*s:a+(-o/2+.5)*s;e.css("background-position",c+"px "+f+"px"),e.find(".fpaim").css({left:Math.round((Number(d)+1)*.5*r),top:Math.round((Number(o)+1)*.5*s),width:r*2,height:s*2})},onclick:function(t){var e=i(this),d=e.width(),o=e.height(),l=t.pageX-e.offset().left,a=t.pageY-e.offset().top,r=this.data("cssGrid")?l/d:(l/d-.5)*2,s=this.data("cssGrid")?a/o:(a/o-.5)*2;this.getCoordField("x").val(r),this.getCoordField("y").val(s),this.updateGrid(),i(this).closest("form").addClass("changed"),i(this.getFieldSelector("x")).length&&i(this.getFieldSelector("x")).each((c,f)=>{i(f).hasClass("editable-column-field")||i(f).change()}),i(this.getFieldSelector("y")).length&&i(this.getFieldSelector("y")).each((c,f)=>{i(f).hasClass("editable-column-field")||i(f).change()})},onmousemove:function(t){var e=i(this),d=e.width(),o=e.height(),l=t.pageX-e.offset().left,a=t.pageY-e.offset().top,r=this.data("cssGrid")?l/d:(l/d-.5)*2,s=this.data("cssGrid")?a/o:(a/o-.5)*-2,c=this.closest(".image-coord-fieldgroup").find(".sumField");c.html("mouseX "+this.roundXYValues(r)+" / mouseY "+this.roundXYValues(s))}})})})(jQuery);
