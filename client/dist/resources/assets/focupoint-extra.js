(function(c){c.entwine("ss",function(t){t(".cms-edit-form").entwine({getCoordField:function(e){var i=e.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName"),d="input[name='"+i+"']";return this.closest(".image-coord-fieldgroup").find(d)},updateGrid:function(){let e=t(".ss-gridfield-item .image-coord-field");e.length&&e.closest("td").addClass("imagecoord image-coord-fieldgroup");var i=t(this),d=i.getCoordField("x").val(),o=i.getCoordField("y").val(),f=11,a=Math.floor(-f/2),r=i.width(),s=i.height(),l=this.data("cssGrid")?a+d*r:a+(d/2+.5)*r,n=this.data("cssGrid")?a+o*s:a+(-o/2+.5)*s;i.css("background-position",l+"px "+n+"px"),i.find(".fpaim").css({left:Math.round((Number(d)+1)*.5*r),top:Math.round((Number(o)+1)*.5*s),width:r*2,height:s*2})},onadd:function(){t(".image-coord-field .grid").each(function(e,i){t(i).closest(".ui-accordion").length&&t(i).closest(".ui-accordion").find(".ui-accordion-header").click(()=>{t(this).updateGrid()})}),this._super()},onchange:function(){t(".uploadfield-item__remove-btn").off("click").click(e=>{let i=t(e.currentTarget).closest(".entwine-uploadfield.uploadfield").find("input");if(i.length){let d=i.attr("name").split("[")[0],o=t('input[name="'+d+'-_1_-FocusPointX"]');o.length&&o.closest(".CompositeField.togglecomposite").remove()}})}});function u(){t(".image-coord-field .grid").each(function(){t(this).updateGrid()})}t(window).on("resize",u),t(".image-coord-field .grid").entwine({onmatch:function(){var e=this;setTimeout(function(){t(".image-coord-fieldgroup").length&&t(".ui-tabs-anchor").click(i=>{setTimeout(()=>{e.updateGrid()},200)}),e.updateGrid()},200)},getCoordField:function(e){var i=e.toUpperCase()==="Y"?this.data("yFieldName"):this.data("xFieldName"),d="input[name='"+i+"']";return this.closest(".image-coord-fieldgroup").find(d)},roundXYValues:function(e){return e.toFixed(4)},updateGrid:function(){let e=t(".ss-gridfield-item .image-coord-field");e.length&&e.closest("td").addClass("imagecoord image-coord-fieldgroup");var i=t(this),d=i.getCoordField("x").val(),o=i.getCoordField("y").val(),f=11,a=Math.floor(-f/2),r=i.width(),s=i.height(),l=this.data("cssGrid")?a+d*r:a+(d/2+.5)*r,n=this.data("cssGrid")?a+o*s:a+(-o/2+.5)*s;i.css("background-position",l+"px "+n+"px"),i.find(".fpaim").css({left:Math.round((Number(d)+1)*.5*r),top:Math.round((Number(o)+1)*.5*s),width:r*2,height:s*2})},onclick:function(e){var i=t(this),d=i.width(),o=i.height(),f=e.pageX-i.offset().left,a=e.pageY-i.offset().top,r=this.data("cssGrid")?f/d:(f/d-.5)*2,s=this.data("cssGrid")?a/o:(a/o-.5)*2;this.getCoordField("x").val(r),this.getCoordField("y").val(s),this.updateGrid(),t(this).closest("form").addClass("changed")},onmousemove:function(e){var i=t(this),d=i.width(),o=i.height(),f=e.pageX-i.offset().left,a=e.pageY-i.offset().top,r=this.data("cssGrid")?f/d:(f/d-.5)*2,s=this.data("cssGrid")?a/o:(a/o-.5)*-2,l=this.closest(".image-coord-fieldgroup").find(".sumField");l.html("mouseX "+this.roundXYValues(r)+" / mouseY "+this.roundXYValues(s))}})})})(jQuery);
